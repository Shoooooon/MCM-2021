from math import radians, cos, sin, asin, sqrt
import pandas as pd
import numpy as np
import datetime as dt
import math
import pymap3d as pm

def transform(Coords_of_points, Center_of_coordinates):
    #input: Coords_of_points - list of coordinates in geodetic coordniates, Center_of_coordinates
    #output:Coords_of_points in local east-north-up coordniates, unit km
    res = []
    for point in Coords_of_points:
        x,y,z = pm.geodetic2enu(point[0], point[0], 0, Center_of_coordinates[0], Center_of_coordinates[0], 0)
        res.append((x/1000,y/1000))
    return res
# Read in data and view description
df = pd.read_csv("Data\wildfire data 2020-2021 + cluster.csv")

df['centroid_geodetic'] = list(zip(df.cluster_centroid_lat, df.cluster_centroid_long))
df.drop(['cluster_centroid_lat', 'cluster_centroid_long'],axis = 1)


df_firecluster = pd.DataFrame(df.groupby(['acq_date',"cluster",'centroid_geodetic'], group_keys=False)[['latitude', 'longitude']].apply(lambda x: x.to_records(index=False).tolist()).reset_index(name='fires_geodetic'))

df_firecluster["fires_cart"] = df_firecluster.apply(lambda x:transform(x.fires_geodetic,x.centroid_geodetic), axis=1)
df_firecluster["centroid.cart"] = df_firecluster.apply(lambda x:(0,0), axis=1)

df_firecluster.head()

df_firecluster.to_csv('saved_data.csv',
        sep=',',index=True)
